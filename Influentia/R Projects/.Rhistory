library(tidyverse)
library(magrittr)
ilinet_tbl  <- read_csv('input/ILINet.csv') %>%
arrange(REGION, YEAR, WEEK)
map(ilinet_tbl, ~length(unique(.x)))
ilinet_tbl <- ilinet_tbl[, map_lgl(ilinet_tbl, ~length(unique(.x)) > 2)]
table(ilinet_tbl$WEEK)
ilinet_tbl <- ilinet_tbl[, map_lgl(ilinet_tbl, ~length(unique(.x)) > 2)]
table(ilinet_tbl$WEEK)
ilinet_tbl %<>%
filter(WEEK != 53)
ilinet_tbl[, 4:7] <- map(ilinet_tbl[, 4:7], as.numeric)
ilinet_tbl %>%
group_by(REGION) %>%
summarise_all(function(x){sum(is.na(x))}) %>%
View
ilinet_tbl %>%
filter(REGION %in% c('Florida', 'Virgin Islands')) %>%
group_by(REGION) %>%
summarise_all(function(x){sum(is.na(x))/length(x)}) %>%
View
ilinet_tbl %<>%
filter(!(REGION %in% c('Florida', 'Virgin Islands')))
ilinet_tbl %<>%
mutate(
YEARWEEK   = paste(YEAR, WEEK, sep = '-'),
PRETTYDATE = as.Date(paste(YEAR, WEEK, 1, sep="-"), "%Y-%U-%u")
)
train <- ilinet_tbl %>%
filter(PRETTYDATE < max(PRETTYDATE) - lubridate::weeks(3))
test <- ilinet_tbl %>%
filter(PRETTYDATE >= max(PRETTYDATE) - lubridate::weeks(3))
saveRDS(train, 'data/train.rds')
saveRDS(test, 'data/test.rds')
write_csv(train, 'data/train.csv')
write_csv(test, 'data/test.csv')
train
train
library(tidyverse)
library(magrittr)
ilinet_tbl  <- read_csv('input/ILINet.csv') %>%
arrange(REGION, YEAR, WEEK)
map(ilinet_tbl, ~length(unique(.x)))
ilinet_tbl <- ilinet_tbl[, map_lgl(ilinet_tbl, ~length(unique(.x)) > 2)]
table(ilinet_tbl$WEEK)
ilinet_tbl %<>%
filter(WEEK != 53)
ilinet_tbl[, 4:7] <- map(ilinet_tbl[, 4:7], as.numeric)
ilinet_tbl %>%
group_by(REGION) %>%
summarise_all(function(x){sum(is.na(x))}) %>%
View
ilinet_tbl %>%
filter(REGION %in% c('Florida', 'Virgin Islands')) %>%
group_by(REGION) %>%
summarise_all(function(x){sum(is.na(x))/length(x)}) %>%
View
ilinet_tbl %<>%
filter(!(REGION %in% c('Florida', 'Virgin Islands')))
ilinet_tbl %<>%
mutate(
YEARWEEK   = paste(YEAR, WEEK, sep = '-'),
PRETTYDATE = as.Date(paste(YEAR, WEEK, 1, sep="-"), "%Y-%U-%u")
)
train <- ilinet_tbl %>%
filter(PRETTYDATE < max(PRETTYDATE) - lubridate::weeks(3))
test <- ilinet_tbl %>%
filter(PRETTYDATE >= max(PRETTYDATE) - lubridate::weeks(3))
p <- plot_ly(ggplot2::train, y = ~REGION, color = ~ILITOTAL, type = "box")
library(tidyverse)
library(magrittr)
library(plotly)
p <- plot_ly(ggplot2::train, y = ~REGION, color = ~ILITOTAL, type = "box")
p <- plot_ly(train, y = ~REGION, color = ~ILITOTAL, type = "box")
plot_ly(train, y = ~REGION, color = ~ILITOTAL, type = "box")
plot_ly(train, x = ~REGION, y = ~ILITOTAL, type = "box")
plot_ly(train, x = ~REGION, y = ~ILITOTAL, type = "box")
plot_ly(train, x = ~REGION, y = ~ILITOTAL, type = "box")
models_auto_arima <- readRDS('data/models_arima.rds')
forecasts_auto_arima <- readRDS('data/forecasts_arima.rds')
plot_forecast_auto_arima <- function(state){
for(state_df in train_split){
if(state_df$REGION==state){
temporal_state_df = state_df
break
}
}
plot(ts(temporal_state_df$ILITOTAL,frequency=52, start=c(2010,40), end=c(2018,20)))
lines(fitted(models_auto_arima[[state]]), col='red')
}
plot_forecast_auto_arima('Colorado')
train <- readRDS('data/train.rds')
test  <- readRDS('data/test.rds')
data_split <- function(data){
data_sp <- lapply(
unique(data$REGION),
function(x) data[data$REGION == x,]
)
}
test_split  <- data_split(test)
train_split <- data_split(train)
plot_forecast_auto_arima <- function(state){
for(state_df in train_split){
if(state_df$REGION==state){
temporal_state_df = state_df
break
}
}
plot(ts(temporal_state_df$ILITOTAL,frequency=52, start=c(2010,40), end=c(2018,20)))
lines(fitted(models_auto_arima[[state]]), col='red')
}
plot_forecast_auto_arima('Colorado')
